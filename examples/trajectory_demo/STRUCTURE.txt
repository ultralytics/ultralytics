================================================================================
              ç¢°æ’æ£€æµ‹Pipeline - å®Œæ•´é¡¹ç›®ç»“æ„
================================================================================


 ğŸ“Œ ã€å¯åŠ¨æ–‡ä»¶ã€‘
 run_pipeline.py                  â­ è¿è¡Œpipelineçš„ä¸»è„š   â””â”€

 ğŸ¯ ã€æ ¸å¿ƒä»£ç ã€‘
   â”œâ”€â”€ collision_detection_pipeline.py  â­ Pipelineå®ç°ï¼ˆ3ä¸ªé˜¶æ®µï¼‰
   â”œâ”€â”€ yolo_runner.py                   YOLOæ£€æµ‹å™¨
   â”œâ”€â”€ object_state_manager.py          ç‰©ä½“çŠ¶æ€ç®¡ç†
   â”œâ”€â”€ coord_transform.py               åæ ‡å˜æ¢å·¥å…·
   â””â”€â”€ calibration.py                   Homographyæ ‡å®šå·¥å…·

 ğŸ“– ã€æ–‡æ¡£ï¼ˆä½ ç°åœ¨çœ‹çš„ï¼‰ã€‘
   â”œâ”€â”€ QUICK_START.md                   å¿«é€Ÿå¼€å§‹æŒ‡å— â­
   â”œâ”€â”€ PIPELINE_USAGE.md                è¯¦ç»†ä½¿ç”¨è¯´æ˜ â­
   â””â”€â”€ STRUCTURE.txt                    é¡¹ç›®ç»“æ„ï¼ˆæ­¤æ–‡ä»¶ï¼‰

 ğŸ”— ã€è¾“å…¥/è¾“å‡ºæ•°æ®ã€‘ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
    â”œâ”€â”€ ../../calibration/
    â”‚   â””â”€â”€ Homograph_Teset_FullScreen_homography.json    (è¾“å…¥æ ‡å®šæ•°æ®)
    â”œâ”€â”€ ../../videos/
 Homograph_Teset_FullScreen.mp4               (    â”‚)   
    â””â”€â”€ ../../results/                                    (æ‰€æœ‰è¿è¡Œç»“æœ)
        â””â”€â”€ 20251218_225957/                              (æ—¶é—´æˆ³æ–‡ä»¶å¤¹)
            â”œâ”€â”€ 1_homography/
            â”‚   â”œâ”€â”€ homography.json         (çŸ©é˜µå¤‡ä»½)
            â”‚   â””â”€â”€ verify_original.jpg     (éªŒè¯å›¾)
            â”œâ”€â”€ 2_warped_video/
            â”‚   â””â”€â”€ warped.mp4              (å˜æ¢)
            â”œâ”€â”€ 3_collision_events/
            â”‚   â”œâ”€â”€ collision_events.json   (äº‹ä»¶åˆ—è¡¨)
            â”‚   â”œâ”€â”€ analysis_report.txt     (åˆ†ææŠ¥å‘Š)
            â”‚   â”œâ”€â”€ event_frame_0001.jpg    (ç¢°æ’äº‹ä»¶å¸§)
            â”‚   â””â”€â”€ ...
            â””â”€â”€ README.md                   (æœ¬æ¬¡è¿è¡Œè¯´æ˜)

================================================================================
                         å¿«é€Ÿå‘½ä»¤å‚è€ƒ
================================================================================

pipelineç›®å½•ã€‘
$ cd /workspace/ultralytics/examples/trajectory_demo

å®Œæ•´é¡¹ç›®ç»“æ„
$ python run_pipeline.py --help

pipelineï¼ˆæ ‡å‡†å‚æ•°ï¼‰ã€‘
$ python run_pipeline.py \
    --video ../../videos/Homograph_Teset_FullScreen.mp4 \
    --homography ../../calibration/Homograph_Teset_FullScreen_homography.json

pipelineï¼ˆè‡ªå®šä¹‰ç½®ä¿¡åº¦ï¼‰ã€‘
$ python run_pipeline.py \
    --video ../../videos/Homograph_Teset_FullScreen.mp4 \
    --homography ../../calibration/Homograph_Teset_FullScreen_homography.json \
    --conf 0.35


$ ls -lh /workspace/ultralytics/results/ | tail -5


$ cat /workspace/ultralytics/results/20251218_225957/3_collision_events/analysis_report.txt

ls /JSONï¼‰ã€‘
$ cat /workspace/ultralytics/results/20251218_225957/3_collision_events/collision_events.json


$ ls /workspace/ultralytics/results/20251218_225957/3_collision_events/event_frame_*.jpg

================================================================================
                      Pipelineä¸‰ä¸ªå¤„ç†é˜¶æ®µ
================================================================================

   â”œâ”€ è¾“å…¥: Homography JSONæ–‡ä»¶
   â”œâ”€ å¤„ç†: éªŒè¯æ ‡å®šçŸ©é˜µå’Œå‚è€ƒç‚¹
   â””â”€ è¾“å‡º: 
      â”œâ”€ homography.json (çŸ©é˜µå¤‡ä»½)
      â””â”€ verify_original.jpg (æ ‡æ³¨å‚è€ƒç‚¹çš„éªŒè¯å›¾)

   â”œâ”€ è¾“å…¥: åŸå§‹è§†é¢‘ + HomographyçŸ©é˜µ
   â”œâ”€ å¤„ç†: åº”ç”¨é€è§†å˜æ¢ (H_inv @ A)
   â””â”€ è¾“å‡º:
      â””â”€ warped.mp4 (é¸Ÿç°å›¾è§†é¢‘, 180Ã—1200åƒç´ )

   â”œâ”€ è¾“å…¥: Warpedè§†é¢‘ + YOLOæ¨¡å‹
   â”œâ”€ å¤„ç†: ç‰©ä½“æ£€æµ‹ + è·ç¦»è®¡ç®— + ç¢°æ’è¯†åˆ«
   â””â”€ è¾“å‡º:
      â”œâ”€ collision_events.json (æ‰€æœ‰ç¢°æ’äº‹ä»¶, JSONæ ¼å¼)
      â”œâ”€ analysis_report.txt (æ±‡æ€»æŠ¥å‘Š)
      â”œâ”€ event_frame_0001.jpg (ç¢°æ’äº‹ä»¶å¸§æˆªå›¾)
      â”œâ”€ event_frame_0002.jpg
      â””â”€ ...

================================================================================
                        å…³é”®é…ç½®å‚æ•°
================================================================================

Pipelineå‚æ•°ã€‘
--video          è¾“å…¥è§†é¢‘è·¯å¾„                    (å¿…éœ€)
--homography     Homography JSONè·¯å¾„             (å¿…éœ€)
--output         ç»“æœè¾“å‡ºåŸºç›®å½•                  (é»˜è®¤: ../../results)
--conf           YOLOç½®ä¿¡åº¦é˜ˆå€¼ (0-1)           (é»˜è®¤: 0.45)

#)

 ç¢°æ’è·ç¦»é˜ˆå€¼:  collision_detection_pipeline.py ç¬¬~150è¡Œ
  - å½“å‰: 0.5m
  - ä¿®æ”¹: if distance < 0.5  â†’  if distance < YOUR_VALUE

 è¾“å‡ºè§†é¢‘åˆ†è¾¨ç‡: collision_detection_pipeline.py ç¬¬~90è¡Œ
  - å½“å‰: (180, 1200)
  - ä¿®æ”¹: output_size = (YOUR_WIDTH, YOUR_HEIGHT)

 YOLOæ¨¡å‹ç‰ˆæœ¬:  collision_detection_pipeline.py ç¬¬~115è¡Œ
  - å½“å‰: yolo11n.pt (æœ€è½»é‡)
  - å¯é€‰: yolo11s.pt, yolo11m.pt, yolo11l.pt (è¶Šæ¥è¶Šé‡)

================================================================================
                         è¾“å‡ºJSONæ ¼å¼
================================================================================

collision_events.jsonã€‘
[
  {
    "frame": 15,              # å¸§å·
    "time": 0.5,              # æ—¶é—´æˆ³ï¼ˆç§’ï¼‰
    "object_ids": [1, 2],     # æ¶‰åŠçš„ç‰©ä½“ID
    "distance": 0.45,         # è·ç¦»ï¼ˆç±³ï¼‰
    "distance_str": "0.45m",  # æ ¼å¼åŒ–è·ç¦»
    "frame_image": "event_frame_0015.jpg"  # å¯¹åº”çš„æˆªå›¾
  },
  ...
]

================================================================================
                          è°ƒè¯•å’Œä¼˜åŒ–
================================================================================

): æœªæ£€æµ‹åˆ°ç‰©ä½“ã€‘
ls /workspace/
#
::: python run_pipeline.py ... --conf 0.3

): æ£€æµ‹å¤ªçµæ•ï¼ˆè¯¯æŠ¥ï¼‰ã€‘
: ç½®ä¿¡åº¦é˜ˆå€¼è¿‡ä½
#
::: python run_pipeline.py ... --conf 0.6

): Warpedè§†é¢‘è´¨é‡å·®ã€‘
#
:
  1. verify_original.jpg ä¸­çš„å‚è€ƒç‚¹æ˜¯å¦æ­£ç¡®
  2. homography.json ä¸­ calibration_error æ˜¯å¦æ¥è¿‘0
  3. åŸå§‹è§†é¢‘æ˜¯å¦æ¸…æ™°


$ cat ../../results/20251218_225957/3_collision_events/analysis_report.txt

================================================================================
                         ç‰ˆæœ¬å’Œä¾èµ–
================================================================================

Required:
  â€¢ Python 3.7+
  â€¢ OpenCV (cv2)
  â€¢ NumPy
  â€¢ YOLOv11 (ultralytics)
  â€¢ PyYAML

: yolo11n.pt (éœ€è‡ªåŠ¨ä¸‹è½½ï¼Œé¦–æ¬¡è¿è¡Œè¾ƒæ…¢)

================================================================================
                          ç¤ºä¾‹å·¥ä½œæµ
================================================================================


$ cd /workspace/ultralytics/examples/trajectory_demo
$ python run_pipeline.py \
    --video ../../videos/Homograph_Teset_FullScreen.mp4 \
    --homography ../../calibration/Homograph_Teset_FullScreen_homography.json


$ cat /workspace/ultralytics/results/20251218_225957/3_collision_events/analysis_report.txt


$ python run_pipeline.py \
    --video ../../videos/Homograph_Teset_FullScreen.mp4 \
    --homography ../../calibration/Homograph_Teset_FullScreen_homography.json \
    --conf 0.35   # æ›´æ•æ„Ÿçš„æ£€æµ‹


$ ls -lh /workspace/ultralytics/results/
$ # æ¯æ¬¡è¿è¡Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ—¶é—´æˆ³æ–‡ä»¶å¤¹

================================================================================
                      è·å–æ›´å¤šå¸®åŠ©
================================================================================

ls /workspace:
  $ cat QUICK_START.md

:
  $ cat PIPELINE_USAGE.md

README:
  $ cat /workspace/ultralytics/results/20251218_225957/README.md

Pipelineæºç :
  $ less collision_detection_pipeline.py

å®Œæ•´é¡¹ç›®ç»“æ„:
  $ python run_pipeline.py --help

================================================================================
                           å®Œæˆï¼
================================================================================

 Pipelineå·²å®‰è£…å¹¶æµ‹è¯•æˆåŠŸ
 å·²ç”Ÿæˆç¤ºä¾‹è¿è¡Œç»“æœ (20251218_225957/)
 æ‰€æœ‰æ–‡æ¡£å·²å‡†å¤‡å¥½
 å¯ç«‹å³å¼€å§‹ä½¿ç”¨

:
  $ cd /workspace/ultralytics/examples/trajectory_demo
  $ python run_pipeline.py --help

================================================================================
